# ===== Exemplo de Variáveis de Ambiente para Netlify =====

# Para configurar no Netlify Dashboard > Site Settings > Environment Variables

# Supabase Configuration
SUPABASE_URL=sua_url_do_supabase_aqui
SUPABASE_ANON_KEY=sua_chave_anonima_do_supabase_aqui
SUPABASE_SERVICE_ROLE_KEY=sua_chave_service_role_do_supabase_aqui

# Admin Configuration
ADMIN_PASSWORD=GestaoProvedores@2025#

# Google OAuth Configuration (opcional - pode ser configurado no frontend)
GOOGLE_CLIENT_ID=seu_google_client_id_aqui

# Email Configuration (para futuras notificações)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=seu_email@gmail.com
SMTP_PASS=sua_senha_de_app_gmail

# Configurações de Segurança
JWT_SECRET=sua_chave_jwt_super_secreta_aqui
CORS_ORIGIN=https://seudominio.netlify.app

# ===== Instruções de Setup =====

# 1. Criar conta no Supabase (https://supabase.com)
# 2. Criar novo projeto
# 3. Ir em Settings > API para obter as chaves
# 4. Executar o SQL schema (ver schema.sql)
# 5. Configurar as variáveis no Netlify Dashboard
# 6. Deploy do projeto

# ===== Schema SQL para Supabase =====
# Execute este SQL no Supabase SQL Editor:

CREATE TABLE users (
  id uuid DEFAULT gen_random_uuid() PRIMARY KEY,
  email text UNIQUE NOT NULL,
  name text NOT NULL,
  photo_url text,
  google_id text,
  company text,
  status text DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'rejected', 'suspended')),
  created_at timestamp DEFAULT now(),
  updated_at timestamp DEFAULT now(),
  last_login timestamp,
  approved_at timestamp,
  approved_by text,
  rejected_at timestamp,
  rejection_reason text,
  suspended_at timestamp,
  suspension_reason text,
  reactivated_at timestamp
);

CREATE TABLE user_activities (
  id uuid DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id uuid REFERENCES users(id) ON DELETE CASCADE,
  action text NOT NULL,
  ip text,
  user_agent text,
  data jsonb DEFAULT '{}',
  created_at timestamp DEFAULT now()
);

CREATE TABLE access_requests (
  id uuid DEFAULT gen_random_uuid() PRIMARY KEY,
  name text NOT NULL,
  email text NOT NULL,
  company text,
  reason text,
  status text DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'rejected')),
  ip text,
  created_at timestamp DEFAULT now(),
  processed_at timestamp,
  processed_by text,
  admin_comments text
);

CREATE TABLE admin_activities (
  id uuid DEFAULT gen_random_uuid() PRIMARY KEY,
  action text NOT NULL,
  data jsonb DEFAULT '{}',
  ip text,
  timestamp timestamp DEFAULT now()
);

CREATE TABLE admin_notifications (
  id uuid DEFAULT gen_random_uuid() PRIMARY KEY,
  type text NOT NULL,
  title text NOT NULL,
  message text,
  data jsonb DEFAULT '{}',
  read boolean DEFAULT false,
  created_at timestamp DEFAULT now()
);

-- Índices para performance
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_status ON users(status);
CREATE INDEX idx_user_activities_user_id ON user_activities(user_id);
CREATE INDEX idx_user_activities_created_at ON user_activities(created_at);
CREATE INDEX idx_access_requests_status ON access_requests(status);
CREATE INDEX idx_admin_activities_timestamp ON admin_activities(timestamp);

-- Políticas de segurança RLS (Row Level Security)
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE user_activities ENABLE ROW LEVEL SECURITY;
ALTER TABLE access_requests ENABLE ROW LEVEL SECURITY;
ALTER TABLE admin_activities ENABLE ROW LEVEL SECURITY;
ALTER TABLE admin_notifications ENABLE ROW LEVEL SECURITY;

-- Políticas para permitir acesso via service role
CREATE POLICY "Service role has full access" ON users
  FOR ALL USING (true);

CREATE POLICY "Service role has full access" ON user_activities
  FOR ALL USING (true);

CREATE POLICY "Service role has full access" ON access_requests
  FOR ALL USING (true);

CREATE POLICY "Service role has full access" ON admin_activities
  FOR ALL USING (true);

CREATE POLICY "Service role has full access" ON admin_notifications
  FOR ALL USING (true);